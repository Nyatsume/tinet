nodes:
- name: R0
  image: frrouting/frr:v8.1.0
  docker_run_extra_args: --entrypoint bash
  interfaces:
    - { name: net0, type: direct, args: R1#net0 }
    - { name: net1, type: direct, args: R2#net0 }
  sysctls:
  - sysctl: net.ipv6.conf.all.disable_ipv6=0
  - sysctl: net.ipv6.conf.default.disable_ipv6=0
  - sysctl: net.ipv4.ip_forward=1
- name: R1
  image: frrouting/frr:v8.1.0
  docker_run_extra_args: --entrypoint bash
  interfaces:
    - { name: net0, type: direct, args: R0#net0 }
    - { name: net1, type: direct, args: R3#net0 }
  sysctls:
  - sysctl: net.ipv6.conf.all.disable_ipv6=0
  - sysctl: net.ipv6.conf.default.disable_ipv6=0
  - sysctl: net.ipv4.ip_forward=1
- name: R2
  image: frrouting/frr:v8.1.0
  docker_run_extra_args: --entrypoint bash
  interfaces:
    - { name: net0, type: direct, args: R0#net1 }
    - { name: net1, type: direct, args: C0#net0 }
  sysctls:
  - sysctl: net.ipv6.conf.all.disable_ipv6=0
  - sysctl: net.ipv6.conf.default.disable_ipv6=0
  - sysctl: net.ipv4.ip_forward=1
- name: R3
  image: frrouting/frr:v8.1.0
  docker_run_extra_args: --entrypoint bash
  interfaces:
    - { name: net0, type: direct, args: R1#net1 }
    - { name: net1, type: direct, args: C1#net0 }
  sysctls:
  - sysctl: net.ipv6.conf.all.disable_ipv6=0
  - sysctl: net.ipv6.conf.default.disable_ipv6=0
  - sysctl: net.ipv4.ip_forward=1

- name: C0
  image: slankdev/ubuntu:18.04
  interfaces:
    - { name: net0, type: direct, args: R2#net1 }
- name: C1
  image: slankdev/ubuntu:18.04
  interfaces:
    - { name: net0, type: direct, args: R3#net1 }

node_configs:
- name: R0
  cmds:
  - cmd: sed -i -e 's/bgpd=no/bgpd=yes/g' /etc/frr/daemons
  - cmd: /usr/lib/frr/frrinit.sh start
  - cmd: ip addr add 10.0.0.1/24 dev net0
  - cmd: ip addr add 10.1.0.1/24 dev net1
  - cmd: >-
      vtysh -c 'conf t'
      -c "router bgp 100"
      -c "bgp router-id 1.1.1.1"
      -c "no bgp network import-check"
      -c "no bgp ebgp-requires-policy"
      -c "bgp graceful-restart"
      -c "neighbor 10.0.0.2 remote-as 200"
      -c "neighbor 10.1.0.2 remote-as 300"
      -c "network 10.1.0.0/24"
      -c "network 10.1.2.0/24"
      -c "do write mem"

- name: R1
  cmds:
  - cmd: sed -i -e 's/bgpd=no/bgpd=yes/g' /etc/frr/daemons
  - cmd: /usr/lib/frr/frrinit.sh start
  - cmd: ip addr add 10.0.0.2/24 dev net0
  - cmd: ip addr add 10.2.0.1/24 dev net1
  - cmd: >-
      vtysh -c 'conf t'
      -c "router bgp 200"
      -c "bgp router-id 2.2.2.2"
      -c "no bgp network import-check"
      -c "no bgp ebgp-requires-policy"
      -c "bgp graceful-restart"
      -c "neighbor 10.0.0.1 remote-as 100"
      -c "neighbor 10.2.0.2 remote-as 400"
      -c "network 10.2.0.0/24"
      -c "network 10.2.4.0/24"
      -c "do write mem"

- name: R2
  cmds:
  - cmd: sed -i -e 's/bgpd=no/bgpd=yes/g' /etc/frr/daemons
  - cmd: /usr/lib/frr/frrinit.sh start
  - cmd: ip addr add 10.1.0.2/24 dev net0
  - cmd: ip addr add 10.3.0.1/24 dev net1
  - cmd: >-
      vtysh -c "conf t"
      -c "router bgp 300"
      -c "bgp router-id 3.3.3.3"
      -c "no bgp ebgp-requires-policy"
      -c "no bgp network import-check"
      -c "neighbor 10.1.0.1 remote-as 100"
      -c "network 10.3.0.0/24"
      -c "do write mem"


- name: R3
  cmds: 
  - cmd: sed -i -e 's/bgpd=no/bgpd=yes/g' /etc/frr/daemons
  - cmd: /usr/lib/frr/frrinit.sh start
  - cmd: ip addr add 10.2.0.2/24 dev net0
  - cmd: ip addr add 10.4.0.1/24 dev net1
  - cmd: >-
      vtysh -c "conf t"
      -c "router bgp 400"
      -c "bgp router-id 4.4.4.4"
      -c "no bgp ebgp-requires-policy"
      -c "no bgp network import-check"
      -c "neighbor 10.2.0.1 remote-as 200"
      -c "network 10.4.0.0/24"
      -c "do write mem"

- name: C0
  cmds:
  - cmd: ip addr add 10.3.0.2/24 dev net0
  - cmd: ip route del default
  - cmd: ip route add default via 10.3.0.1
- name: C1
  cmds:
  - cmd: ip addr add 10.4.0.2/24 dev net0
  - cmd: ip route del default
  - cmd: ip route add default via 10.4.0.1
  
